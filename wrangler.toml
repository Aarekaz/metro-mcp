name = "metro-mcp"
main = "src/index.ts"
compatibility_date = "2025-12-25"
workers_dev = true

# Preserve environment variables set in dashboard on deploy
keep_vars = true

# Minify JavaScript for better performance
minify = true

# Upload source maps for better error debugging
upload_source_maps = true

# KV Namespaces for OAuth client registration
[[kv_namespaces]]
binding = "OAUTH_CLIENTS"
id = "44f6224b68354c24bf071e2b53b13dbb"
preview_id = "7d10b069531a459cb56ed59220ede55b"

# KV Namespace for rate limiting
# WHY SEPARATE KV:
# - High write volume (every request)
# - Automatic expiration via TTL
# - Different access patterns than OAuth data
# - Better performance and cost optimization
#
# SETUP INSTRUCTIONS:
# 1. Create production KV namespace:
#    wrangler kv:namespace create "RATE_LIMIT_KV"
# 2. Create preview KV namespace:
#    wrangler kv:namespace create "RATE_LIMIT_KV" --preview
# 3. Update the IDs below with the output from those commands
#
# TEMPORARY: Using placeholder IDs - update these after creating KV namespaces
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "PLACEHOLDER-CREATE-WITH-WRANGLER-KV-NAMESPACE-CREATE"
preview_id = "PLACEHOLDER-CREATE-WITH-WRANGLER-KV-NAMESPACE-CREATE-PREVIEW"

# Non-secret environment variables
[vars]
GITHUB_CLIENT_ID = "Ov23liGFwmOZeECJ6yeN"  # OAuth client ID (public, not a secret)
OAUTH_REDIRECT_URI = "https://metro-mcp.aarekaz.workers.dev/callback"

# Observability and logging configuration
[observability]
enabled = true  # Enable for production monitoring

[observability.logs]
enabled = true  # Enable logging
head_sampling_rate = 0.1  # Sample 10% of requests (adjust as needed)
invocation_logs = true
